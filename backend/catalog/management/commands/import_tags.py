from django.core.management.base import BaseCommand
from catalog.models import Tag


RAW_TAGS = """
#ДІТЯМ
#ПІДЛІТКАМ
#ПСИХОЛОГІЯ
#ІСТОРІЯ
#НОН-ФІКШН
#ЗАРУБІЖНА КЛАСИКА
#УКРАЇНСЬКА КЛАСИКА
#ФАНТАСТИКА
#ФЕНТЕЗІ
#РОМАНТИКА
#СУЧАСНА ЗАРУБІЖНА  ПРОЗА
#СУЧАСНА УКРАЇНСЬКА ПРОЗА
#УКРАЇНСЬКА ЛІРИКА
#ЗАРУБІЖНА ЛІРИКА
#ПОДАРУНКОВЕ ВИДАННЯ
#ГРАФІЧНИЙ РОМАН
#МАГІЧНИЙ РЕАЛІЗМ
#УРБАНІЗМ
#РЕАЛІЗМ
#ПОСТМОДЕРНІЗМ
#СЮРРЕАЛІЗМ
#ЖАХИ
#ДЕТЕКТИВ
#ТРИЛЕР
#ДРАМА
#КОМЕДІЯ
#захований скарб
#головоломки
#екзотичні локації
#екшн
#всеохопна загроза
#війна
#любовна лінія
#ч/б мораль
#сіра мораль
#артефакт
#подвійний агент
#тварини, що розмовляють
#дружба
#допомога слабшому
#долання труднощів
#опанування нових навичок
#управління емоціями
#школа
#енциклопедії
#сила уяви
#робота в команді
#сміливість
#співчуття
#дорослішання
#втрата
#наш час
#стосунки
#родина
#психічні відхилення
#залежності
#лгбт
#відкритий фінал
#нетрадиційна структура сюжету
#без містики
#смерть
#квест
#обраний
#лиходій
#наставник
#магічні істоти
#високе фентезі
#епічне фентезі
#спадкоємець трону
#несподівані союзники
#герой мимоволі
#прокляті предмети
#прокляття
#монстри
#інопланетяни
#антихрист
#демони
#культи
#травматичне минуле
#постапокаліпсис
#апокаліпсис
#будинок з привидами
#вбивця-психопат
#несподіваний фінал
#підозрюваний-протагоніст
#герметичний детектив
#втрата пам’яті
#любовний трикутник
#від ворогів до закоханих
#вимушена близькість
#заборонене кохання
#фальшиві стосунки
#кохання з першого погляду
#доленосні  стосунки
#від друзів до закоханих
#другий шанс
#нерівний статус
#подорожі в часі
#інший вимір
#космос
#технології
#проблемний протагоніст
#ненадійний оповідач
#зниклі діти
#переслідування
#аутсайдер
#перше кохання
#особливі здібності
#академія
#фантастична раса
#вибір/внутрішній конфлікт
#критика суспільного устрою
#викрадення
#теорія змови
#обмежений час
#класичне вбивство
#детектив-аматор
#старий злочин
#подорожі
#загублений світ
#альтернативна історія
#переосмислення відомого сюжету
#політичні інтриги
#визначні історичні події
#колонізація
#токсичні стосунки
#таємниці минулого
#нецензурна лексика
#еротичні сцени
#насилля
"""


def normalize_tag(line: str) -> str:
    # прибираємо #, зайві пробіли, подвійні пробіли
    t = line.strip()
    if not t:
        return ""
    if t.startswith("#"):
        t = t[1:]
    t = " ".join(t.split())  # схлопує будь-які множинні пробіли
    return t.strip()


class Command(BaseCommand):
    help = "Import predefined tags into DB (idempotent)."

    def handle(self, *args, **options):
        lines = RAW_TAGS.splitlines()
        tags = []
        for ln in lines:
            name = normalize_tag(ln)
            if name:
                tags.append(name)

        created = 0
        existed = 0

        for name in tags:
            obj, was_created = Tag.objects.get_or_create(Name=name)
            if was_created:
                created += 1
            else:
                existed += 1

        self.stdout.write(self.style.SUCCESS(
            f"Done. Created: {created}, existed: {existed}, total input: {len(tags)}"
        ))
